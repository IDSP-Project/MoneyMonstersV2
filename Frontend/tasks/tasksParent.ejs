<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Money Monsters - Tasks</title>
  <link rel="stylesheet" href="/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <div class="tasks">
    <div class="container">
      <header>
        <%- include('../partials/header') %>
      </header>
      <main>
        <div class="tasks-container">
          <div class="add-task-btn-container">
            <button class="add-task-btn">Add New Task</button>
          </div>
          <% const statusGroups = {
            'in_progress': { title: 'In Progress', tasks: [] },
            'new': { title: 'Assigned', tasks: [] },
            'overdue': { title: 'Overdue', tasks: [] },
            'completed': { title: 'Complete', tasks: [] }
          };
          if (tasks && tasks.length > 0) {
            tasks.forEach(function(task) {
              if (statusGroups[task.status]) {
                statusGroups[task.status].tasks.push(task);
              }
            });
          %>
            <% Object.keys(statusGroups).forEach(function(statusKey) { %>
              <% if (statusGroups[statusKey].tasks.length > 0) { %>
                <div class="task-section-box">
                  <div class="task-section">
                    <div class="task-section-title"><%= statusGroups[statusKey].title %></div>
                    <div class="task-list">
                      <% statusGroups[statusKey].tasks.forEach(function(task) { %>
                        <div class="task-card">
                          <div class="task-info">
                            <% 
                              let iconClass = 'fa-solid ';
                              switch(task.category) {
                                case 'pet': iconClass += 'fa-dog'; break;
                                case 'cleaning': iconClass += 'fa-broom'; break;
                                case 'garage': iconClass += 'fa-warehouse'; break;
                                case 'garden': iconClass += 'fa-leaf'; break;
                                case 'misc': iconClass += 'fa-circle-check'; break;
                                default: iconClass += 'fa-list-check';
                              }
                            %>
                            <i class="<%= iconClass %> task-icon"></i>
                            <div class="task-text">
                              <h3><%= task.title %></h3>
                              <small class="due-date" data-due="<%= task.dueDate.toISOString ? task.dueDate.toISOString() : task.dueDate %>">$<%= task.reward ? task.reward.toFixed(2) : '0.00' %> | <%= task.formattedDue %></small>
                            </div>
                          </div>
                          <div class="task-status">
                            <span class="status-badge <%= task.status %>">
                              <%= task.status ? task.status.charAt(0).toUpperCase() + task.status.slice(1).replace('_', ' ') : 'New' %>
                            </span>
                          </div>
                        </div>
                      <% }); %>
                    </div>
                  </div>
                </div>
              <% } %>
            <% }); %>
          <% } else { %>
            <div class="no-tasks-message">
              <i class="fas fa-tasks"></i>
              <h2>No Tasks Yet</h2>
              <p>Your children don't have any tasks assigned yet.</p>
            </div>
          <% } %>
        </div>
      </main>
      <footer>
        <%- include('../partials/bottomNav') %>
      </footer>
      <div id="selectTaskTypeModal" class="task-modal" style="display: none;">
        <div class="task-modal-content">
          <h2 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1.2rem;">Select Task Type</h2>
          <div class="task-type-icons-row">
            <div class="task-type-icon" data-category="pet">
              <i class="fa-solid fa-dog"></i>
              <div class="task-type-label">Pet</div>
            </div>
            <div class="task-type-icon" data-category="cleaning">
              <i class="fa-solid fa-broom"></i>
              <div class="task-type-label">Cleaning</div>
            </div>
            <div class="task-type-icon" data-category="garage">
              <i class="fa-solid fa-warehouse"></i>
              <div class="task-type-label">Garage</div>
            </div>
            <div class="task-type-icon" data-category="garden">
              <i class="fa-solid fa-leaf"></i>
              <div class="task-type-label">Garden</div>
            </div>
            <div class="task-type-icon" data-category="misc">
              <i class="fa-solid fa-circle-check"></i>
              <div class="task-type-label">Misc.</div>
            </div>
          </div>
          <div id="taskTypeError" class="modal-error"></div>
          <button class="confirm-btn" id="confirmTaskTypeBtn">Confirm</button>
          <button class="cancel-btn" id="cancelTaskTypeBtn">Cancel</button>
        </div>
      </div>
      <div id="addTaskDetailsModal" class="task-modal" style="display: none;">
        <div class="task-modal-content add-task-details-modal-content">
          <div class="task-details-icon-row">
            <span id="taskDetailsIconCircle" class="task-details-icon-circle">
              <!-- Icon will be injected here -->
            </span>
            <span class="task-details-title">Select Task Type</span>
          </div>
          <input type="text" id="taskDetailsDescription" class="task-details-input" placeholder="Task details" maxlength="60" />
          <input type="number" id="taskDetailsAmount" class="task-details-input" placeholder="Amount • $" min="0" step="0.01" />
          <input type="date" id="taskDetailsDate" class="task-details-input" placeholder="By • Date" />
          <input type="time" id="taskDetailsTime" class="task-details-input" placeholder="By • Time" />
          <button class="confirm-btn" id="confirmAddTaskBtn">Confirm</button>
          <button class="cancel-btn" id="cancelAddTaskBtn">Cancel</button>
        </div>
      </div>
    </div>
  </div>
  <script src="/dynamic/formatDueDates.js"></script>
  <script src="/dynamic/taskModal.js"></script>
</body>
</html> 