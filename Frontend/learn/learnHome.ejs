<!DOCTYPE html>
 <html lang="en">
 <head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
   <title>Money Monsters Learn</title>
   <link rel="stylesheet" href="/style.css" />
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
 </head>

<div class="learn">
    <div class="container">
    <header>
      <%- include('../partials/header') %>
      <% if (locals.viewingAsChild && locals.viewingChildName) { %>
        <%- include('../partials/viewingAsChild') %>
      <% } %>
    </header>
    <main>
          <h3><%= viewingAsChild ? viewingChildName : user.firstName %>'s Reading List</h3>
          <% if (user.accountType === 'parent') { %>
            <div class="learn-admin-actions">
              <a href="/learn/new" class="btn">Add New Learn Article</a>
            </div>
          <% } %>

          <% blogs.forEach(blog => { 
            const progressStatus = blogProgressMap[blog._id.toString()] || "todo";
       %>
          <div class="blog-card">
            <div class="blog-content">
            <div class="blog-cat">
              <h5><%= blog.category %></h5>
            </div>
            <div class="blog-title">
              <h3><a href="/learn/view/<%= blog._id %>"><%= blog.title %></a></h3>
              <% const blogIdStr = blog._id.toString(); const status = blogProgressMap[blogIdStr] || 'To Do'; %>
            <span id="status-<%= blogIdStr %>" class="status-badge <%= status === 'Complete' ? 'complete' : 'todo' %>">
              <%= status === 'Complete' ? 'Complete' : 'To Do' %>
            </span>
            </div>
            <div class="blog-summary">
              <p><%= blog.summary %></p>
            </div>
          </div>
        </div>

        <% }) %>

      </main>
        <footer>
    <%- include('../partials/bottomNav') %>
  </footer>
  <script>
  async function markLearningComplete(blogId) {
    try {
      const res = await fetch(`/progress/${blogId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ status: "Complete" }),
      });

      if (res.ok) {
        document.getElementById(`status-${blogId}`).textContent = "Complete";
        document.getElementById(`status-${blogId}`).classList.remove("todo");
        document.getElementById(`status-${blogId}`).classList.add("complete");
      }
    } catch (err) {
      console.error("Failed to mark complete:", err);
    }
  }
</script>

    </div>
        </div>
